
namespace = null;

function newQuat(q) {
    return new namespace.THREE.Quaternion(q['x'], q['y'], q['z'], q['w']);
}

function new3DVec(x, y, z) {
    return new namespace.THREE.Vector3(x, y, z);
}

function setQuat(q) {
    namespace.vectorQuaternion = q;
    namespace.vectorQuaternion.normalize();
    namespace.updateRotationAxis();
    namespace.updateVectorVisuals();
    namespace.updateRotationInfo();
    namespace.renderer.render(namespace.scene, namespace.camera);
}


var viewQuat = 'QC';
function processQuatJSON(data) {
    for (var key in data) {
	if (data.hasOwnProperty(key)) {
	    $('#' + key).text(data[key]['s']);
	}
    }
    //q = newQuat(data['QC']);
    //q = newQuat(data['QJ']);
    q = newQuat(data[viewQuat]);
    setQuat(q);
}

var buttonQC, buttonQJ, buttonQE;
$(function() {
    iframe = $('iframe')[0];
    namespace = iframe.contentWindow;
    console.log("hello");
    setTimeout(function() {
	$('#animationCheckbox', $('iframe').contents()).prop('checked', false).trigger('change');
    }, 1000);
    setInterval(function() {
	$.getJSON( "/latestQuaternion.py", processQuatJSON);
    }, 100);
    buttonQC = $('input', $('#QC').parent());
    buttonQJ = $('input', $('#QJ').parent());
    buttonQE = $('input', $('#QE').parent());
    buttonQC.click(function() {
	viewQuat = 'QC';
	buttonQC.attr('disabled', 'disabled');
	buttonQJ.removeAttr('disabled');
	buttonQE.removeAttr('disabled');
    });
    buttonQJ.click(function() {
	viewQuat = 'QJ';
	buttonQJ.attr('disabled', 'disabled');
	buttonQC.removeAttr('disabled');
	buttonQE.removeAttr('disabled');
    });
    buttonQE.click(function() {
	viewQuat = 'QE';
	buttonQE.attr('disabled', 'disabled');
	buttonQJ.removeAttr('disabled');
	buttonQC.removeAttr('disabled');
    });
});
